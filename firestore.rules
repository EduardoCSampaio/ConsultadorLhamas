/**
 * @fileoverview Firestore Security Rules for Beleza Integrada.
 *
 * Core Philosophy:
 * This ruleset provides public read access to webhook responses but restricts write access.
 * Only authenticated users can create, update, or delete webhook responses.
 *
 * Data Structure:
 * Webhook responses are stored in the `/webhookResponses/{webhookResponseId}` collection.
 *
 * Key Security Decisions:
 * - Public read access allows for monitoring and debugging of webhook integrations.
 * - Owner-only write access ensures that only authenticated users can modify webhook responses.
 * - Listing webhook responses is public.
 *
 * Denormalization for Authorization:
 * The `WebhookResponse` documents are self-contained and do not rely on external data for authorization.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows public read access to webhook responses, but restricts write access to authenticated users.
     * @path /webhookResponses/{webhookResponseId}
     * @allow (get, list) Any user can read webhook responses.
     * @allow (create) Any authenticated user can create a webhook response.
     * @deny (create) An unauthenticated user cannot create a webhook response.
     * @deny (update, delete) Only the user who created the webhook response can update or delete it.
     * @principle Enables public read access while enforcing owner-only writes.
     */
    match /webhookResponses/{webhookResponseId} {
      allow get: if true;
      allow list: if true;

      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    function isSignedIn() {
      return request.auth != null;
    }
  }
}